# CRM Reuse / Refactor / Rewrite – Inventory & Related Modules

| module_name                           | domain                 | responsibilities                                                                 | apis_exposed                                                           | events_published                                            | tech_debt_level | reuse_strategy | notes |
|---------------------------------------|------------------------|----------------------------------------------------------------------------------|-------------------------------------------------------------------------|-------------------------------------------------------------|-----------------|----------------|-------|
| `backend` monolith (`app/…`)          | mixed (CRM-lite, ERP)  | Legacy customer CRUD, documents, ad-hoc endpoints, auth middleware               | REST `/api/v1/crm/*`, `/api/v1/documents/*`                              | few/not domain-driven (`documents.updated`)                 | **high**        | **rewrite**    | CRM bounded context should not extend this monolith; keep only for transitional read models. |
| `services/inventory` (new microservice) | Inventory              | Warehouses, locations, stock, transactions                                      | REST `/api/v1/inventory/...`, `/api/v1/warehouses/...`                   | none yet                                                    | medium          | **reuse**      | Already extracted. Build CRM adapters (product availability in Customer 360°, timeline entries) via `crm-sync`. |
| `packages/frontend-web` CRM screens (e.g. `verkauf/kunden-stamm.tsx`) | Frontend               | Basic customer forms, sales lists                                                | GraphQL/REST via `apiClient`                                           | n/a                                                         | medium          | **refactor**   | Reuse form components in Customer-360°, embed view into new routes, retire standalone lists after migration. |
| `services/workflow`                   | Workflow/Tickets       | Approval flows, tasks                                                            | REST `/api/v1/workflows/...`                                           | `workflow.task.updated`                                     | medium          | **reuse**      | CRM Service workspace consumes tasks via adapters; add missing ticket events through `crm-sync`. |
| `services/ai`                         | Generic AI layer       | GPT-like orchestrations, SSE dev server                                         | REST `/ai/*`, SSE                                                      | `ai.request.logged`                                         | low             | **reuse**      | Extend with CRM-specific prompts (compose, summarise) inside `ai-crm` service to keep guardrails. |
| `packages/bff/bff-web`                | API Gateway            | Proxy, auth, SSR                                                                | Aggregated BFF endpoints                                               | n/a                                                         | medium          | **refactor**   | Update routing to include `/crm/*` modules, ensure multi-tenant headers forwarded. |
| `services/finance` (planned)          | Finance                | Invoices, payments                                                              | REST `/api/v1/*` (Finance)                                            | `invoice.posted`, `payment.overdue`                         | medium          | **reuse**      | CRM subscribes to finance events via `crm-sync` (order history, risk scoring). |
| `services/dms` / Document modules     | DMS                    | File storage, contract PDFs                                                      | REST `/api/v1/documents`, WebDAV                                      | `dms.document.uploaded`                                     | medium          | **reuse**      | Add RAG connectors for AI queries, surface doc links in Customer 360° timeline. |
| `services/order` / Sales domain       | Sales                  | Orders, deliveries                                                               | REST `/api/v1/orders`                                                 | `order.created`, `delivery.shipped`                        | medium          | **reuse**      | CRM consumes events for timeline and analytics; add canonical customer reference mapping. |
| `services/integration` (if any)       | Integration            | External sync jobs                                                               | batch APIs                                                             | minimal                                                     | high            | **rewrite**    | Replace ad-hoc scripts with `crm-sync` event-driven adapters. |

## Rationale
- Modules already extracted as microservices (Inventory, AI, Workflow) are **reused** with adapters to the CRM bounded context.
- Monolithic or inconsistent CRM logic is **rewritten** inside the new services to gain clean domain boundaries.
- Shared UI components are **refactored** into the new CRM route/layout rather than rebuilt from scratch.
