version: "3.9"

services:
  # PostgreSQL für Guacamole
  postgres:
    image: postgres:14
    container_name: guac-postgres
    environment:
      POSTGRES_USER: guacamole_user
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: guacamole_db
      TZ: Europe/Berlin
    volumes:
      - ./pg-data:/var/lib/postgresql/data
    restart: unless-stopped
    networks:
      - guac-network

  # Guacamole Daemon
  guacd:
    image: guacamole/guacd:latest
    container_name: guacd
    restart: unless-stopped
    networks:
      - guac-network

  # Guacamole Web-UI
  guacamole:
    image: guacamole/guacamole:latest
    container_name: guacamole
    depends_on:
      - postgres
      - guacd
    environment:
      GUACD_HOSTNAME: guacd
      POSTGRES_HOSTNAME: postgres
      POSTGRES_DATABASE: guacamole_db
      POSTGRES_USER: guacamole_user
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_PORT: 5432
      TZ: Europe/Berlin
    ports:
      - "8080:8080"
    restart: unless-stopped
    networks:
      - guac-network

  # Webtop (Linux Desktop im Browser - optional)
  webtop:
    image: lscr.io/linuxserver/webtop:ubuntu-xfce
    container_name: webtop
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Berlin
      - CUSTOM_USER=valeo
      - PASSWORD=${WEBTOP_PASSWORD}
    volumes:
      - ./webtop-config:/config
      - ./l3-screenshots:/config/screenshots
    ports:
      - "3001:3000"  # Port 3001 (Frontend läuft auf 3000)
    shm_size: "2gb"
    restart: unless-stopped
    networks:
      - guac-network

networks:
  guac-network:
    driver: bridge

volumes:
  pg-data:
  webtop-config:

